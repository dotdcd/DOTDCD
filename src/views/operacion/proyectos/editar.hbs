<div class="row">
    <div class="col-xl-12">
        <div id="panel-1" class="panel">
            <div class="panel-hdr">
                <h2>
                    Editar Proyecto <span class="fw-300"><i>DOTDCD - ERP</i></span>
                </h2>
                <div class="panel-toolbar">
                    <button class="btn btn-panel" data-action="panel-collapse" data-toggle="tooltip" data-offset="0,10"
                        data-original-title="Collapse"></button>
                    <button class="btn btn-panel" data-action="panel-fullscreen" data-toggle="tooltip"
                        data-offset="0,10" data-original-title="Fullscreen"></button>
                    <button class="btn btn-panel" data-action="panel-close" data-toggle="tooltip" data-offset="0,10"
                        data-original-title="Close"></button>
                </div>
            </div>
            <div class="panel-container show">
                <div class="panel-content">
                    <div id="metasAll">

                        <!-- Formulario  -->
                        <form class="form-group ccontainer" method="post" action="/updProyecto/{{p.cotizacion_id}}">
                            <label class="form-label col-12" for="simpleinput">
                                <h3 class="text-center">Editar Proyecto</h3>
                            </label><br />
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="container"> <!-- sistema de niveles -->
                                        <div class="row">
                                            <div class="table-responsive rounded">
                                                <table class=" table table-success  ">
                                                    <thead class="rounded ">
                                                        <tr class="text-center">
                                                            <th colspan="4" class="text-center">
                                                                <h3>RESUMEN</h3>
                                                            </th>

                                                        </tr>
                                                    </thead>
                                                    <tbody>

                                                        <tr>
                                                            <th>Nombre del Proyecto</th>
                                                            <td>{{p.cotizacion_proyecto}}</td>
                                                            <th>Estatus</th>
                                                            <th>Fecha</th>
                                                        </tr>

                                                        <tr>
                                                            <th>Descripcion del Proyecto</th>
                                                            <td>{{p.cotizacion_descripcion}}</td>
                                                            <td>
                                                                <select name="" disabled
                                                                    style="background-color: #BEEDE8;"
                                                                    class="form-control" id="">
                                                                    <option value="0" {{#if (is
                                                                        p.cotizacion_autorizada_estatus 0)}} selected {{/if}}>Cotizada</option>
                                                                    <option value="1" {{#if (is
                                                                        p.cotizacion_autorizada_estatus 1)}} selected {{/if}}>Autorizada</option>
                                                                    <option value="2" {{#if (is
                                                                        p.cotizacion_autorizada_estatus 2)}} selected {{/if}}>Terminada</option>
                                                                    <option value="9" {{#if (is
                                                                        p.cotizacion_autorizada_estatus 9)}} selected {{/if}}>Poliza</option>
                                                                </select>
                                                            </td>
                                                            <td>{{p.cotizacion_fecha_alta}}</td>
                                                        </tr>
                                                        <tr>
                                                            <th>Moneda</th>
                                                            <td><select name="" class="form-control" disabled id=""
                                                                    style="background-color: #BEEDE8; color:black !important; width: 100%; height: 100%;">
                                                                    {{#each moneda}}
                                                                    <option value="{{moneda_id}}" {{#if
                                                                        (is../p.cotizacion_moneda_id moneda_id) }} selected {{/if}}>{{moneda_descripcion}}</option>
                                                                    {{/each}}
                                                                </select></td>
                                                            <td></td>

                                                            <td></td>
                                                        </tr>
                                                        <tr class="">

                                                            <td id="miBoton" class="text-center" colspan="4">
                                                                <h4 class="text-black">Observaciones</h4>
                                                                <textarea name="" id="" cols="30" rows="2" disabled
                                                                    class="form-control">{{p.cotizacion_observaciones}}</textarea>
                                                                <button style="cursor:pointer;"
                                                                    class="btn btn-primary  btn-block "
                                                                    type="button">Modificar</button>
                                                            </td>

                                                        </tr>
                                                        <tr>
                                                        <tr>
                                                            <th>% PF</th>
                                                            <th>IVA</th>
                                                            <th>% Descuento</th>
                                                            <th>Cantidad Descuento</th>
                                                        </tr>

                                                        <td id="txtpf">{{p.pf}}</td>
                                                        <td><select name="" class="form-control" disabled id=""
                                                                style="background-color: #BEEDE8; color:black !important; width: 100%; height: 100%;">
                                                                <option value="0" {{#if (is p.estimacion_iva 0 estimacion_iva)}} selected {{/if}}>No</option>
                                                                <option value="1" {{#if (is p.estimacion_iva 1 estimacion_iva)}} selected {{/if}}>Si</option>
                                                            </select></td>
                                                        <td><input type="text" id="descuento_porcentaje"
                                                                class="form-control"
                                                                value="{{p.cotizacion_descuento_porcentaje}}"
                                                                onKeyup="calcular_pie(1);"></td>
                                                        <td><input type="text" id="descuento_cantidad"
                                                                class="form-control"
                                                                value="{{p.cotizacion_descuento_porcentaje}}"
                                                                onKeyup="calcular_pie(2);"></td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="4">
                                                                <input type="text"
                                                                    value="{{p.cotizacion_compras_totalizadas}}">
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>

                                                {{#if (is p.cotizacion_tipo_id 1)}} 

                                                    <table class="table table-success">
                                                    <tr>
                                                        <th>Producto</th>
                                                        <th>Marca</th>
                                                        <th>Cantidad</th>
                                                        <th>Material</th>
                                                        <th>M.O.</th>
                                                        <th>Subtotal</th>
                                                    </tr>
                                                    {{#each psimple}}
                                                        <tr>
                                                            <td>{{producto_descripcion}}</td>
                                                            <td>{{marca_descripcion}}</td>
                                                            <td id="insumo_cantidad">{{insumo_cantidad}}</td>
                                                            <td id="insumo_precio_ma">{{insumo_precio_ma}}</td>
                                                            <td id="insumo_precio_mo">{{insumo_precio_mo}}</td>
                                                            <td id="simpleSubtotal" ></td>
                                                        </tr>
                                                    {{/each}}
                                                    <tr class="justify-content-center text-align-center">
                                                        <td colspan="6"><center><button type="button" onclick="addProducto()" class="btn btn-info">Agregar Insumo</button> <button type="button" onclick="addServicio()" class="btn btn-warning">Agregar Servicio</button></center> </td>   
                                                    </tr>

                                                </table>
                                                {{/if}}
                                                    
                                                    {{#if (is p.cotizacion_tipo_id 2)}}
                                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="accordion w-100 bg-success" id="insumosAccordion">
                                                {{#each insumos}}
                                                <div class="card">
                                                    <div class="card-header" id="heading{{@index}}">
                                                        <h2 class="mb-0">
                                                            <button class="btn btn-block btn-lg text-white"
                                                                style="background-color: #5A9A5A;" type="button"
                                                                data-toggle="collapse" data-target="#collapse{{@index}}"
                                                                aria-expanded="true" aria-controls="collapse{{@index}}">
                                                                {{diciplina_descripcion}}
                                                            </button>
                                                        </h2>
                                                    </div>

                                                    <div id="collapse{{@index}}" class="collapse"
                                                        aria-labelledby="heading{{@index}}"
                                                        data-parent="#insumosAccordion">
                                                        <div class="card-body">
                                                            <table class="table table-hover text-center">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Producto</th>
                                                                        <th>Marca</th>
                                                                        <th>Cantidad</th>
                                                                        <th>Material</th>
                                                                        <td>Insumo Precio MA</td>
                                                                        <th>Precio MO</th>
                                                                        <th>Subtotal</th>
                                                                        <th>Accion</th>
                                                                    </tr>

                                                                    <tr>

                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    {{#each insumos}}
                                                                    <tr>
                                                                        <td>{{producto}}</td>
                                                                        <td>{{marca_descripcion}}</td>
                                                                        <td>{{insumo_cantidad}}</td>
                                                                        <td>{{tm_tipo}}</td>
                                                                        <td>{{insumo_precio_ma}}</td>
                                                                        <td>{{insumo_precio_mo}}</td>
                                                                        <td id="subtotal">{{importe}}</td>

                                                                        <td>
                                                                            <div class="d-flex justify-content-between">
                                                                                <button
                                                                                    class="btn btn-circle btn-sm btn-primary m-1">agregar</button>
                                                                                <button
                                                                                    class="btn btn-circle btn-sm btn-secondary m-1">eliminar</button>
                                                                                <button
                                                                                    class="btn btn-circle btn-sm btn-success m-1">editar</button>
                                                                            </div>

                                                                        </td>

                                                                    </tr>
                                                                    {{/each}}
                                                                    <tr>
                                                                        <td>Total</td>
                                                                        <td id="total"></td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                                {{/each}}
                                            </div>
                                        </div>
                                    </div>
                                                    {{/if}}



                                                <!--

                                                <table class="table table-success text-center" id="productos">
                                                <tr>
                                                    <th>Producto</th>
                                                    <th>Marca</th>
                                                    <th>Cantidad</th>
                                                    <th>Material</th>
                                                    <th>M.O.</th>
                                                    <th>Subtotal</th>
                                                    <th>Acciones</th>
                                                    
                                                </tr>
                                                <tbody id="table-body">
                                                {{#each prodProyecto}}
                                                <tr>
                                                    <td>{{producto_descripcion}}</td>
                                                    <td>{{marca_descripcion}}</td>
                                                    <td>{{insumo_cantidad}}</td>
                                                    <td>{{tipo_material}}</td>
                                                    <td>{{producto_mo}}</td>
                                                    <td id="subtotal">{{producto_precio_tarjeta}}</td>
                                                    <td><button type="button" class="btn btn-danger remove-row-btn" onclick="calcularTotal()">Eliminar</button></td>
                                                </tr>
                                                {{/each}}
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td id="total"></td>
                                                    <td></td>

                                                </tr>
                                                </tbody>
                                               
                                                
                                                <tr>
                                                    <td><button id="add-row-btn" type="button" class="btn btn-primary">Agregar producto</button></td>

                                                </tr>
                                                
                                            </table>
                                             -->
                                            </div>
                                        </div>
                                    </div> <br><br>





                                    











                                    <div class="row">
                                        <div class="col-md-6">
                                            <span>Cliente</span>
                                            <select name="cotizacion_cliente_id" class="form-control" id="">
                                                {{#each clientes}}
                                                <option value="{{cliente_id}}" {{#if (is../p.cotizacion_cliente_id
                                                    cliente_id) }} selected {{/if}}>{{cliente_razon_social}}</option>
                                                {{/each}}
                                            </select><br />

                                            <span>Contacto</span>
                                            <input type="text" id="simpleinput" class="form-control" placeholder=""
                                                name="cotizacion_contacto" value="{{p.cotizacion_contacto}}"><br />

                                            <span>Empleado</span>
                                            <select name="cotizacion_empleado_id" class="form-control" id="">
                                                {{#each empleados}}
                                                <option value="{{empleado_id}}" {{#if (is../p.cotizacion_empleado_id
                                                    empleado_id) }} selected {{/if}}>{{nombre_completo}}</option>
                                                {{/each}}
                                            </select><br />

                                            <span> Tipo de cotización</span>
                                            <select name="cotizacion_tipo_id" class="form-control" id="">
                                                {{#each clase}}
                                                <option value="{{cotizacion_tipo_id}}" {{#if (is../p.cotizacion_tipo_id
                                                    cotizacion_tipo_id) }} selected {{/if}}>
                                                    {{cotizacion_tipo_descripcion}}
                                                </option>
                                                {{/each}}
                                            </select><br />

                                            <span>Moneda</span>
                                            <select name="cotizacion_moneda_id" id="" class="form-control">
                                                {{#each moneda}}
                                                <option value="{{moneda_id}}" {{#if (is../p.cotizacion_moneda_id
                                                    moneda_id) }} selected {{/if}}>{{moneda_descripcion}}</option>
                                                {{/each}}
                                            </select><br />

                                            <span>IVA</span>
                                            <select name="estimacion_iva" id="" class="form-control">
                                                <option value="0" {{#if (is p.estimacion_iva 0 estimacion_iva)}}
                                                    selected {{/if}}>No</option>
                                                <option value="1" {{#if (is p.estimacion_iva 1 estimacion_iva)}}
                                                    selected {{/if}}>Si</option>
                                            </select><br />

                                            <span>Empresa </span><!--Empresas loop-->
                                            <select name="cotizacion_empresa_id" id="" class="form-control">
                                                {{#each empresaa}}
                                                <option value="{{id}}" {{#if (is../p.cotizacion_empresa_id id) }}
                                                    selected {{/if}}>{{empresa_razon_social}}</option>
                                                {{/each}}
                                            </select><br />
                                        </div>
                                        <!--aqui se divide-->
                                        <div class="col-md-6">


                                            <span>Sucursal</span>
                                            <select name="sucursal_id" class="form-control" id="">
                                                {{#each sucursales}}
                                                <option value="{{sucursal_id}}" {{#if (is../p.sucursal_id sucursal_id)
                                                    }} selected {{/if}}>{{sucursal_nombre}}</option>
                                                {{/each}}
                                            </select><br />

                                            <span>Nombre del Proyecto</span>
                                            <input type="text" class="form-control" name="cotizacion_proyecto"
                                                value="{{p.cotizacion_proyecto}}"><br />

                                            <span>Descripcion</span>
                                            <input type="text" class="form-control" name="cotizacion_descripcion"
                                                value="{{p.cotizacion_descripcion}}"><br />

                                            <span>Ubicacion de la Obra</span>
                                            <input type="text" class="form-control" name="cotizacion_ubicacion"
                                                value="{{p.cotizacion_ubicacion}}"><br />

                                            <span>Condiciones Comerciales</span>
                                            <input type="text" class="form-control"
                                                name="cotizacion_condiciones_comerciales"
                                                value="{{p.cotizacion_condiciones_comerciales}}"><br />

                                            <span>Observaciones</span>
                                            <input id="miInput" type="text" class="form-control"
                                                name="cotizacion_observaciones"
                                                value="{{p.cotizacion_observaciones}}"><br />

                                            <span>Estatus</span>
                                            <select name="cotizacion_estatus_baja" class="form-control" id="">
                                                <option value="0" {{#if (is p.cotizacion_estatus_baja 0)}} selected
                                                    {{/if}}>
                                                    Activo</option>
                                                <option value="1" {{#if (is p.cotizacion_estatus_baja 1)}} selected
                                                    {{/if}}>
                                                    Inactivo</option>
                                            </select>
                                        </div>
                                    </div>

                                    <br><br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <button type="submit" class="btn btn-info btn-lg btn-block">Guardar</button>
                                        </div>
                                        <div class="col-md-6">
                                            <a href="/dashboard/operacion/proyectos/buscar"
                                                class="btn btn-danger btn-lg btn-block">Cancelar</a>

                                        </div>
                                    </div>
                                </div>
                            </div>

                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<table id="tabla" class="table table-striped">


</table>
<div id="contenido"></div>

{{#section 'scripts'}}

<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
    .counter {
        text-align: center;
        font-weight: bold;
    }
</style>
<script>


        //alerta para producto
        function addProducto(){
            Swal.fire({
  title: 'Agregar Producto',
  html: `
    <div class="container">
        <div class="row">
            <div class="col-6">
                <label for="first-input">Nombre</label>
                <input id="first-input" class="form-control">
                <label for="second-input">Marca</label>
                <input id="second-input" class="form-control">
            </div>
            <div class="col-6">
                <label for="third-input">Cantidad</label>
                <input id="third-input" class="form-control">
                <label for="fourth-input">Materiales</label>
                <input id="fourth-input" class="form-control">
            </div>
        </div>
    </div>
  `,
  showCancelButton: true,
  confirmButtonText: 'Submit',
  preConfirm: () => {
    return [
      document.getElementById('first-input').value,
      document.getElementById('second-input').value,
      document.getElementById('third-input').value,
      document.getElementById('fourth-input').value
    ]
  }
}).then((result) => {
  if (result.isConfirmed) {
    Swal.fire({
      title: 'Submitted Information',
      html: `
        First Input: ${result.value[0]}<br>
        Second Input: ${result.value[1]}<br>
        Third Input: ${result.value[2]}<br>
        Fourth Input: ${result.value[3]}
      `
    })
  }
})
        }


//funcion para agregar servicio
function addServicio(){
            Swal.fire({
  title: 'Submit your information',
  html: `
    <div class="container">
        <div class="row">
            <div class="col-6">
                <label for="first-input">Nombre</label>
                <input id="first-input" class="form-control">
                <label for="second-input">Marca</label>
                <input id="second-input" class="form-control">
            </div>
            <div class="col-6">
                <label for="third-input">Cantidad</label>
                <input id="third-input" class="form-control">
                <label for="fourth-input">Materiales</label>
                <input id="fourth-input" class="form-control">
            </div>
        </div>
    </div>
  `,
  showCancelButton: true,
  confirmButtonText: 'Submit',
  preConfirm: () => {
    return [
      document.getElementById('first-input').value,
      document.getElementById('second-input').value,
      document.getElementById('third-input').value,
      document.getElementById('fourth-input').value
    ]
  }
}).then((result) => {
  if (result.isConfirmed) {
    Swal.fire({
      title: 'Submitted Information',
      html: `
        First Input: ${result.value[0]}<br>
        Second Input: ${result.value[1]}<br>
        Third Input: ${result.value[2]}<br>
        Fourth Input: ${result.value[3]}
      `
    })
  }
})
        }








    //funcion para calcular subtotal de insumo para cotizacion simple
    function calcularSubtotal() {
       var cantidad = document.getElementById("insumo_cantidad").innerText;
        var ma = document.getElementById("insumo_precio_ma").innerText;
        var mo = document.getElementById("insumo_precio_mo").innerText;
            cantidad = parseFloat(cantidad);
            ma = parseFloat(ma);
            mo = parseFloat(mo);

         

		     subtotal = (ma + mo) * cantidad
             console.log(ma,  mo, cantidad)
             console.log((1116.78 + 28.65)*187)
            document.getElementById("simpleSubtotal").innerHTML = "$" + subtotal.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');

}
    
    calcularSubtotal();
    addEventListener("load", calcularSubtotal);
    



</script>
{{/section}}

{{#section 'styles'}}
<style>
    #accordion {
        width: 400px;
    }

    #accordion h3 {
        cursor: pointer;
        padding: 10px;
        background-color: #f0f0f0;
        border-bottom: 1px solid #ccc;
    }

    #accordion div {
        display: none;
        padding: 10px;
        background-color: #fdfdfd;
    }

    #accordion div.show {
        display: block;
    }
</style>
{{/section}}